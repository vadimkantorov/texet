<!doctype html>
  <html>
    <head>
      <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
      <script src="https://mozilla.github.io/pdf.js/build/pdf.worker.js"></script>
      
      <link rel="stylesheet" href="https://unpkg.com/xterm@3.8.0/dist/xterm.css" />
      <script src="https://unpkg.com/xterm@3.8.0/dist/xterm.js"></script>
      <script src="https://unpkg.com/xterm@3.8.0/dist/addons/fit/fit.js"></script>
      <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
      <style>
        
        html, body{
          height: 100%;
          width: 100%;
          margin: 0;
          padding: 0;
          overflow: hidden;
        }
        #editor {
          height: 30%;
          width: 100%;
          margin: 0;
          padding: 0;
          overflow: hidden;
        }
        #terminal {
            height: 30%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        .xterm-viewport {
            overflow-y: hidden !important
        }
      </style>
    </head>
    <body>
      <div id="editor"></div>
      <div id="terminal"></div>
      <div id="viewer"><canvas id="pdfcanvas"></canvas></div>
      <script>


        // atob() is used to convert base64 encoded PDF to binary-like data.
        // (See also https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/
        // Base64_encoding_and_decoding.)
        var pdfData = atob(
              'JVBERi0xLjcKCjEgMCBvYmogICUgZW50cnkgcG9pbnQKPDwKICAvVHlwZSAvQ2F0YWxvZwog' +
              'IC9QYWdlcyAyIDAgUgo+PgplbmRvYmoKCjIgMCBvYmoKPDwKICAvVHlwZSAvUGFnZXMKICAv' +
              'TWVkaWFCb3ggWyAwIDAgMjAwIDIwMCBdCiAgL0NvdW50IDEKICAvS2lkcyBbIDMgMCBSIF0K' +
              'Pj4KZW5kb2JqCgozIDAgb2JqCjw8CiAgL1R5cGUgL1BhZ2UKICAvUGFyZW50IDIgMCBSCiAg' +
              'L1Jlc291cmNlcyA8PAogICAgL0ZvbnQgPDwKICAgICAgL0YxIDQgMCBSIAogICAgPj4KICA+' +
              'PgogIC9Db250ZW50cyA1IDAgUgo+PgplbmRvYmoKCjQgMCBvYmoKPDwKICAvVHlwZSAvRm9u' +
              'dAogIC9TdWJ0eXBlIC9UeXBlMQogIC9CYXNlRm9udCAvVGltZXMtUm9tYW4KPj4KZW5kb2Jq' +
              'Cgo1IDAgb2JqICAlIHBhZ2UgY29udGVudAo8PAogIC9MZW5ndGggNDQKPj4Kc3RyZWFtCkJU' +
              'CjcwIDUwIFRECi9GMSAxMiBUZgooSGVsbG8sIHdvcmxkISkgVGoKRVQKZW5kc3RyZWFtCmVu' +
              'ZG9iagoKeHJlZgowIDYKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAwMDEwIDAwMDAwIG4g' +
              'CjAwMDAwMDAwNzkgMDAwMDAgbiAKMDAwMDAwMDE3MyAwMDAwMCBuIAowMDAwMDAwMzAxIDAw' +
              'MDAwIG4gCjAwMDAwMDAzODAgMDAwMDAgbiAKdHJhaWxlcgo8PAogIC9TaXplIDYKICAvUm9v' +
              'dCAxIDAgUgo+PgpzdGFydHhyZWYKNDkyCiUlRU9G');

        // Loaded via <script> tag, create shortcut to access PDF.js exports.
        var pdfjsLib = window['pdfjs-dist/build/pdf'];

        // The workerSrc property shall be specified.
        pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';

        // Using DocumentInitParameters object to load binary data.
        var loadingTask = pdfjsLib.getDocument({data: pdfData});
        loadingTask.promise.then(function(pdf) {
              console.log('PDF loaded');
              
              // Fetch the first page
              var pageNumber = 1;
              pdf.getPage(pageNumber).then(function(page) {
                      console.log('Page loaded');
                      
                      var scale = 1.5;
                      var viewport = page.getViewport({scale: scale});

                      // Prepare canvas using PDF page dimensions
                      var canvas = document.getElementById('pdfcanvas');
                      var context = canvas.getContext('2d');
                      canvas.height = viewport.height;
                      canvas.width = viewport.width;

                      // Render PDF page into canvas context
                      var renderContext = {
                                canvasContext: context,
                                viewport: viewport
                              };
                      var renderTask = page.render(renderContext);
                      renderTask.promise.then(function () {
                                console.log('Page rendered');
                              });
                    });
        }, function (reason) {
              // PDF loading error
              console.error(reason);
        });

        

        //import { FitAddon } from 'fit.js';
        var term = new Terminal();
        //fitAddon = new FitAddon();
        //term.loadAddon(fitAddon);
        term.open(document.getElementById('terminal'));
        //fitAddon.fit();

        var curLine = '';
        term.write('Hello from \x1B[1;3;31mxterm.js\x1B[0m $ ');
        term.on('key', (key, ev) => {
            if(ev.keyCode == 13)
            {
                term.write('\r\n');
                console.log(curLine);
                curLine = '';
            }
            else
            {
                curLine += key;
                term.write(key);
            }
        });
        
        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@latest/min/vs' }});
        window.MonacoEnvironment = { getWorkerUrl: () => proxy };

        let proxy = URL.createObjectURL(new Blob([`
          self.MonacoEnvironment = {
            baseUrl: 'https://unpkg.com/monaco-editor@latest/min/'
          };
          importScripts('https://unpkg.com/monaco-editor@latest/min/vs/base/worker/workerMain.js');
        `], { type: 'text/javascript' }));

        require(["vs/editor/editor.main"], function () {
          let editor = monaco.editor.create(document.getElementById('editor'), {
            value: [
              'function x() {',
              '\tconsole.log("Hello world!");',
              '}'
            ].join('\n'),
            language: 'javascript',
            theme: 'vs-dark'
          });
        });
        
    
      </script>
    </body>
  </html>
